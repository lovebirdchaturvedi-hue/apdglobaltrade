<script type="module">
import { auth, db } from "./js/firebase-init.js";
import {
  signInWithEmailAndPassword,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  // ðŸ”¥ STEP 1: CHECK ADMIN ROLE FIRST
  const token = await user.getIdTokenResult(true);
  if (token.claims.role === "admin") {
    window.location.href = "/admin-dashboard.html";
    return;
  }

  // ðŸ”¹ STEP 2: NORMAL SUPPLIER FLOW
  const ref = doc(db, "suppliers", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    window.location.href = "/register-supplier.html";
    return;
  }

  const data = snap.data();

  if (data.status === "approved") {
    window.location.href = "/supplier-dashboard.html";
  } else if (data.status === "rejected") {
    window.location.href = "/account-rejected.html";
  } else {
    window.location.href = "/pending-approval.html";
  }
});
</script>
