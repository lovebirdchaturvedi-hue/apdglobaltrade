<!DOCTYPE html>
<html>
<head>
  <title>Supplier Login â€“ APD Global Trade</title>
</head>

<body>
<h2>Supplier Login</h2>

<input type="email" id="email" placeholder="Email" /><br><br>
<input type="password" id="password" placeholder="Password" /><br><br>

<button id="loginBtn">Login</button>

<p id="error" style="color:red;"></p>

<script type="module">
import { auth, db } from "./js/firebase-init.js";
import { signInWithEmailAndPassword, onAuthStateChanged } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const errorEl = document.getElementById("error");

loginBtn.addEventListener("click", async () => {
  errorEl.innerText = "";

  try {
    await signInWithEmailAndPassword(
      auth,
      emailInput.value,
      passwordInput.value
    );
  } catch (err) {
    errorEl.innerText = err.message;
  }
});

onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  const ref = doc(db, "suppliers", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    window.location.href = "/register-supplier.html";
    return;
  }

  const status = snap.data().status;

  if (status === "approved") {
    window.location.href = "/supplier-dashboard.html";
  } else if (status === "pending") {
    window.location.href = "/pending-approval.html";
  } else if (status === "rejected") {
    window.location.href = "/account-rejected.html";
  }
});
</script>

</body>
</html>
