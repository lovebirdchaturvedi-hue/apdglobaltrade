<!DOCTYPE html>
<html>
<head>
  <title>Supplier Login â€“ APD Global Trade</title>
</head>

<body>
<h2>Supplier Login</h2>

<input type="email" id="email" placeholder="Email"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>

<script type="module">
import { auth, db } from "./js/firebase-init.js";
import { signInWithEmailAndPassword, onAuthStateChanged } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, getDoc } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

async function login() {
  const email = email.value;
  const password = password.value;

  await signInWithEmailAndPassword(auth, email, password);
}

onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  const ref = doc(db, "suppliers", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    location.href = "/register-supplier.html";
    return;
  }

  const status = snap.data().status;

  if (status === "approved") location.href = "/supplier-dashboard.html";
  if (status === "pending") location.href = "/pending-approval.html";
  if (status === "rejected") location.href = "/account-rejected.html";
});
</script>
</body>
</html>
