<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supplier Management</title>
  <link rel="stylesheet" href="assets/admin.css">
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>APD Admin</h2>
  <a href="dashboard.html">Dashboard</a>
  <a href="rfqs.html">RFQs</a>
  <a href="suppliers.html" class="active">Suppliers</a>
  <button class="logout" id="logoutBtn">Logout</button>
</div>

<!-- MAIN CONTENT -->
<div class="main">
  <h1>Supplier Management</h1>

  <table border="1" width="100%" cellpadding="10" style="background:#fff;border-collapse:collapse">
    <thead>
      <tr>
        <th>Company</th>
        <th>Contact Person</th>
        <th>Email</th>
        <th>Country</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="supplierTable">
      <tr>
        <td colspan="6">Loading suppliers...</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    getDocs,
    updateDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ðŸ”¥ YOUR FIREBASE CONFIG (CONFIRMED CORRECT)
  const firebaseConfig = {
    apiKey: "AIzaSyAB-FuXAKzTnVDKCety55SD7W5Xlf1vSm4",
    authDomain: "apd-global-trade.firebaseapp.com",
    projectId: "apd-global-trade",
    storageBucket: "apd-global-trade.appspot.com",
    messagingSenderId: "821359117885",
    appId: "1:821359117885:web:9107322b75d38baaba4c54"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ðŸ” AUTH CHECK
  onAuthStateChanged(auth, user => {
    if (!user) {
      window.location.href = "login.html";
    } else {
      loadSuppliers();
    }
  });

  // ðŸ“¥ LOAD SUPPLIERS
  async function loadSuppliers() {
    const table = document.getElementById("supplierTable");
    table.innerHTML = "";

    try {
      const snapshot = await getDocs(collection(db, "suppliers"));

      if (snapshot.empty) {
        table.innerHTML = "<tr><td colspan='6'>No suppliers found</td></tr>";
        return;
      }

      snapshot.forEach(docSnap => {
        const s = docSnap.data();

        table.innerHTML += `
          <tr>
            <td>${s.company || "-"}</td>
            <td>${s.contactPerson || "-"}</td>
            <td>${s.email || "-"}</td>
            <td>${s.country || "-"}</td>
            <td><strong>${s.status}</strong></td>
            <td>
              <button onclick="updateStatus('${docSnap.id}', 'approved')">Approve</button>
              <button onclick="updateStatus('${docSnap.id}', 'rejected')">Reject</button>
            </td>
          </tr>
        `;
      });

    } catch (err) {
      console.error(err);
      table.innerHTML = "<tr><td colspan='6'>Permission denied or error loading data</td></tr>";
    }
  }

  // âœ… UPDATE STATUS
  window.updateStatus = async (id, status) => {
    if (!confirm("Are you sure you want to " + status + " this supplier?")) return;

    await updateDoc(doc(db, "suppliers", id), {
      status: status
    });

    alert("Supplier " + status);
    loadSuppliers();
  };

  // ðŸšª LOGOUT
  document.getElementById("logoutBtn").onclick = () => {
    signOut(auth).then(() => {
      window.location.href = "login.html";
    });
  };
</script>

</body>
</html>
