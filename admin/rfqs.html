<!DOCTYPE html>
<html>
<head>
  <title>RFQ Management | APD Admin</title>
  <link rel="stylesheet" href="assets/admin.css">
</head>
<body>

<div class="sidebar">
  <h2>APD Admin</h2>
  <a href="dashboard.html">Dashboard</a>
  <a href="rfqs.html" class="active">RFQs</a>
  <a href="suppliers.html">Suppliers</a>
  <button id="logoutBtn">Logout</button>
</div>

<div class="main">
  <h1>RFQ Management</h1>

  <table border="1" width="100%" cellpadding="10" style="background:#fff">
    <thead>
      <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Origin</th>
        <th>Port</th>
        <th>Buyer</th>
        <th>Type</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="rfqTable"></tbody>
  </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    getDocs,
    updateDoc,
    doc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAB-FuXAKzTnVDKCety55SD7W5Xlf1vSm4",
    authDomain: "apd-global-trade.firebaseapp.com",
    projectId: "apd-global-trade",
    storageBucket: "apd-global-trade.appspot.com",
    messagingSenderId: "821359117885",
    appId: "1:821359117885:web:9107322b75d38baaba4c54"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, user => {
    if (!user) location.href = "login.html";
    loadRFQs();
  });

  async function loadRFQs() {
    const table = document.getElementById("rfqTable");
    table.innerHTML = "";

    const snap = await getDocs(collection(db, "rfqs"));
    snap.forEach(docSnap => {
      const r = docSnap.data();

      table.innerHTML += `
        <tr>
          <td>${r.product}</td>
          <td>${r.quantity}</td>
          <td>${r.origin || "-"}</td>
          <td>${r.destinationPort || "-"}</td>
          <td>${r.buyerCompany || "â€”"}</td>
          <td>${r.rfqType || "buyer"}</td>
          <td>${r.status}</td>
          <td>
            <button onclick="updateStatus('${docSnap.id}','approved')">Approve</button>
            <button onclick="updateStatus('${docSnap.id}','rejected')">Reject</button>
          </td>
        </tr>
      `;
    });
  }

  window.updateStatus = async (id, status) => {
    await updateDoc(doc(db, "rfqs", id), { status });
    alert("RFQ " + status);
    loadRFQs();
  };

  document.getElementById("logoutBtn").onclick = () => {
    signOut(auth).then(() => location.href = "login.html");
  };
</script>

</body>
</html>
